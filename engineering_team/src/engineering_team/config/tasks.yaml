architecture_task:
  description: >
    Design the complete architecture for {feature_name} within our current Rails-based,
    Hotwire-enabled application. The architecture must support scalable, Jira-like patterns:
    workflow states, assignments, comments, activity logs, permission roles, filtering,
    and fast UI interactions.
    Requirements: {requirements}
    Produce a full architecture specification including:
    1. Database Schema
       - Table structures with correct column types, enums, workflow fields
       - Indexes optimized for filtering/sorting (e.g., status, assigned_to_id)
       - Foreign keys and cascading rules
       - Migration file examples
    2. Models
       - Complete associations between models (e.g., project → tickets, ticket → comments, ticket → activity logs)
       - Validations, scopes, enums (e.g., :open, :in_progress, :blocked, :resolved)
       - Concise class/instance methods supporting workflow transitions
    3. Routes
       - RESTful route definitions
       - Nested resources when relevant (e.g., tickets/:id/comments)
       - Routes for workflow transitions (e.g., POST /tickets/:id/transition)
    4. Controller Structure
       - CRUD actions and workflow transition actions
       - Strong parameters and permitted fields
       - Before actions for permission checks or loading entities
    5. Service Objects (for business logic)
       - Workflow transition services
       - Assignment/notification services
       - Query/filter services (e.g., TicketFilterService)
    Format output as structured markdown with code examples.
  expected_output: >
    A production-grade technical specification document describing all architectural
    decisions, database schema, model design, routes, controller outlines, and service patterns.
  agent: rails_architect
  output_file: output/{feature_name}_architecture.md

frontend_task:
  description: >
    Build complete frontend UI for {feature_name} using Slim, Stimulus, Bootstrap 5,
    and Turbo Streams. The UI should resemble modern ticketing systems (Jira, Linear),
    with responsive layouts and fast Hotwire interactions.

    Based on the architecture, deliver:

    1. Slim View Templates
       - Index: list, table, or kanban board based on requirements
       - Show: ticket detail with comments, activity, attachments
       - Form views: new/edit with Bootstrap form structure
       - Reusable components: status badges, assignment dropdowns, modals

    2. Stimulus Controllers
       - Interaction logic (status changes, filtering, modal handling)
       - Turbo Stream integration for live updates
       - Loading states, error states, optimistic updates

    3. Bootstrap 5 Integration
       - Use only Bootstrap 5 (no Tailwind)
       - Proper grid system usage
       - Buttons, navbars, modals, cards, alerts, forms
       - Accessible patterns (ARIA, roles, keyboard nav)

    4. Turbo Frames & Streams
       - Inline updates without reloads
       - Dynamic actions (transition status, comment creation)

    Requirements: {requirements}

    IMPORTANT:
    - No ERB, Slim only
    - No custom CSS unless absolutely required
    - Must be mobile-responsive using Bootstrap grid
    - Must include UI/UX states: loading, disabled, errors

  expected_output: >
    Complete set of frontend templates (Slim), Stimulus controllers, reusable UI components,
    and Turbo-ready interactions for immediate integration.
  agent: frontend_developer
  context:
    - architecture_task
  output_file: output/{feature_name}_views.txt

integration_task:
  description: >
    Build the Rails controllers and routing that connect the frontend and backend.
    Follow Rails conventions, ensure clean strong parameters, and support full workflow.

    Based on the architecture and frontend output, create:

    1. Controller Files
       - RESTful CRUD actions for {feature_name}
       - Workflow transition actions
       - Commenting, assignment, filtering, etc.
       - Before actions (load resources, authenticate, authorize)

    2. Routes Configuration
       - routes.rb definitions
       - Named routes for workflow transitions
       - Nested comments or activity resources if applicable

    3. Helpers
       - View helpers for status badges, formatted timestamps, etc.

    4. Flash Messages
       - Success/error handling
       - Turbo-stream friendly flashes when needed

    5. Error Handling
       - Validation failures
       - Not found / unauthorized states
       - Graceful fallbacks

    Requirements: {requirements}

    IMPORTANT:
    - Use strong parameters strictly
    - Keep controllers concise (push logic to services)
    - Add comments for clarity
    - Ensure RESTful structure with clean redirects and Turbo responses

  expected_output: >
    Fully implemented Rails controllers and routes ready for use in app/controllers/,
    including helpers and error-handling logic.
  agent: integration_engineer
  context:
    - architecture_task
    - frontend_task
  output_file: output/{feature_name}_controllers.rb

migration_task:
  description: >
    Generate all migration files needed for {feature_name} based on the architecture.

    Deliver:
    - Table creation migrations
    - Column additions/modifications
    - Foreign keys
    - Indexes (especially for filtering: status, assigned_to, priority)
    - Full reversible up/down methods

    Requirements: {requirements}

    IMPORTANT:
    - Use Rails migration DSL
    - Always include timestamps
    - Add indexing for performance
    - Ensure reversible migrations

  expected_output: >
    Complete set of migration files ready to run immediately.
  agent: rails_architect
  context:
    - architecture_task
  output_file: output/{feature_name}_migrations.rb

model_task:
  description: >
    Create complete Rails model files for {feature_name}.

    Based on the architecture, include:
    - Associations (belongs_to, has_many, has_rich_text etc.)
    - Validations
    - Scopes for filtering (e.g., by status, priority, assignee)
    - Enums for workflow states
    - Instance methods for transitions, display formatting
    - Concise business logic (heavier logic must be placed into service objects)

    Requirements: {requirements}

    IMPORTANT:
    - Strictly follow Rails naming conventions
    - Keep models lean
    - Add descriptive scopes
    - Use enums for workflows

  expected_output: >
    Complete model files ready for app/models/ with associations, validations, enums,
    and lightweight logic.
  agent: rails_architect
  context:
    - architecture_task
  output_file: output/{feature_name}_models.rb
